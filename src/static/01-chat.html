<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width" />
    <script src="https://unpkg.com/protobufjs@6.11.2/dist/protobuf.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/colyseus.js@^0.15.0/dist/colyseus.js"></script>
</head>

<body>
    <strong>客户端A</strong><br />

    <input type="text" id="input" value="" autofocus />
    <input type="submit" id="submitValue" value="send" />

    <div id="messages"></div>

    <script>
        protobuf.load("./protobuf/person.proto", function (err, root) {
            if (err) throw err;

            var Person = root.lookupType("Person");

            var client = new Colyseus.Client("ws://localhost:2567");
            var room;

            client.joinOrCreate("chat").then(room_instance => {
                room = room_instance;

                room.onMessage("typeMessage", (message) => {
                    console.log('客户端收到消息', message);
                    var decodedMessage = Person.decode(new Uint8Array(message));
                    console.log("Received message:", decodedMessage);
                });




                document.querySelector("#submitValue").onclick = function () {
                    var payload = { age: 15, name: '张三' };
                    var errMsg = Person.verify(payload);
                    if (errMsg) throw Error(errMsg);

                    var message = Person.create(payload);
                    var buffer = Person.encode(message).finish();

                    console.log('客户端发送消息', buffer);

                    room.sendBytes('typeMessage', buffer);
                };
            });
        });
    </script>
</body>

</html>